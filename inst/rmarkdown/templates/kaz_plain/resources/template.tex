\documentclass[a4paper]{article}


% ------------------------------------------------ %
%                                                  %
%              Fonts and typography                %
%                                                  %
% ------------------------------------------------ %

%% Typography
\usepackage[no-math]{fontspec}
\usepackage{color}

%% Fonts
% \setmainfont{Open Sans}
% \setsansfont{Open Sans}
% \setmonofont{Open Sans}

\setmainfont{Ubuntu}
\setsansfont{Ubuntu}
\setmonofont{Ubuntu}

%% Set Sans font in headings
\usepackage{sectsty}
\allsectionsfont{\sffamily}

%% Set polyglossia language
\usepackage{polyglossia}
\setdefaultlanguage{english}
% disable hyphenation
%\hyphenpenalty = 10000

%% Emphasizing inline code output
\usepackage{alltt}


% ------------------------------------------------ %
%                                                  %
%              Settings for knitr                  %
%                                                  %
% ------------------------------------------------ %

%% for Shaded environment in knitr
\usepackage{framed}
\usepackage{fancyhdr}

%% landscape mode
\usepackage{lscape}

%% Encoding
%\usepackage[UTF-8]{inputenc}

% rowspacing
\usepackage{setspace}

% ------------------------------------------------ %
%                                                  %
%              Page settings                       %
%                                                  %
% ------------------------------------------------ %

%% Use full page in book style
\usepackage[top=3.5cm, bottom=3.5cm, left=1.5cm, right=1.5cm]{geometry}

%% Set line spacing
\usepackage{setspace}
\setstretch{1.0}

%% Disable paragraph indentation
\usepackage{parskip}

%% Custom headers
\usepackage{fancyhdr}

% ------------------------------------------------ %
%                                                  %
%                  Headings                        %
%                                                  %
% ------------------------------------------------ %

\usepackage{titlesec, blindtext, color}

% spacin before and after the section titles
\titlespacing*{\section}{0pt}{2.5ex}{0.5ex}
\titlespacing*{\subsection}{0pt}{0.2ex}{0.2ex}

%\definecolor{SkyBlue}{HTML}{3465A4}
\definecolor{green}{RGB}{26,150,65}
\newcommand{\hsp}{\hspace{20pt}}
% add the green vertical line after 1st level heading
\titleformat{\section}[hang]{\large\bfseries}{\thesection\hsp\textcolor{green}{|}\hsp}{0pt}{\large\bfseries}

\usepackage{enumerate}

%% Disable section numbers
\setcounter{secnumdepth}{1}


% ------------------------------------------------ %
%                                                  %
%               Table of content                   %
%                                                  %
% ------------------------------------------------ %

% dotted lines for table of content

\makeatletter
\renewcommand*\l@section{\@dottedtocline{1}{1.5em}{2.3em}}
\makeatother
\setcounter{tocdepth}{1}

% ------------------------------------------------ %
%                                                  %
%               % Colors                           %
%                                                  %
% ------------------------------------------------ %
\usepackage{xcolor}

%% Tango color scheme
\definecolor{SkyBlue}{HTML}{3465A4}
\definecolor{DarkSkyBlue}{HTML}{204A87}
\definecolor{Plum}{HTML}{75507B}
\definecolor{ScarletRed}{HTML}{CC0000}
\definecolor{Aluminium1}{HTML}{EEEEEC}
\definecolor{Aluminium6}{HTML}{2e3436}
\definecolor{Black}{HTML}{000000}

% ------------------------------------------------ %
%                                                  %
%               Links                              %
%                                                  %
% ------------------------------------------------ %

%% Hyperref
\usepackage[colorlinks, breaklinks, bookmarks]{hyperref}

\hypersetup {
  linkcolor = Aluminium6,
  citecolor = DarkSkyBlue,
  filecolor = DarkSkyBlue,
  urlcolor = DarkSkyBlue
}

%% Donâ€™t use Mono font for URLs
\urlstyle{same}


% ------------------------------------------------ %
%                                                  %
%               Images & tables                    %
%                                                  %
% ------------------------------------------------ %

% Images
\usepackage{graphicx}
% tables
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{float}
\restylefloat{table}

 \renewcommand\arraystretch{1.1} % table rowheight
% see: http://everythingyouforgetaboutlatex.blogspot.fi/2008/10/formatting-tables.html
\setlength{\intextsep}{-0.1cm} % spacing between floats



% ------------------------------------------------ %
%                                                  %
%               First page graphics                %
%                                                  %
% ------------------------------------------------ %

%\usepackage[showframe,textwidth=3.0in]{geometry}
\usepackage{xstring}% for string comparrison
\usepackage{calc}%    for \widthof
\usepackage{pgf}%     for math calclations

% \newlength{\Size}
% \newcommand*{\PositionText}[3][l]{%
%     \IfStrEqCase{#1}{%
%         {l}{\noindent\hspace{#2}#3}%
%         {c}{\pgfmathsetlength{\Size}{#2-0.5*(\widthof{#3})}\noindent\hspace{\Size}#3}%
%         {r}{\pgfmathsetlength{\Size}{#2-1.0*(\widthof{#3})}\noindent\hspace{\Size}#3}%
%         }[\PackageError{PositionText}
%             {\MessageBreak Unrecognized alignment: #1.\MessageBreak
%             Valid alignments are are `l`, `c`, `r'}{}]%
% }%


% First page background graphics
\usepackage{eso-pic}
\newcommand\firstpagebackground{%
\put(0,0){%
\parbox[b][\paperheight]{\paperwidth}{%
\vfill
\centering
\includegraphics[width=\paperwidth,height=\paperheight,%
keepaspectratio]{bg_1st_page.pdf}%
\vfill
}}}
%
% Embedding
\usepackage{pdfpages}

% % ------------------------------------------------ %
% %                                                  %
% %               Absolute text positions            %
% %                                                  %
% % ------------------------------------------------ %
%
%
% \usepackage[absolute]{textpos}
%
% \setlength{\TPHorizModule}{30mm}
% \setlength{\TPVertModule}{\TPHorizModule}
% \textblockorigin{10mm}{10mm} % start everything near the top-left corner
% \setlength{\parindent}{0pt}

% Modifying the title

\makeatletter
\renewcommand{\maketitle}{\bgroup\setlength{\parindent}{0pt}
\begin{flushleft}
  \textsc{\LARGE \@title }

  \large \textbf{\@author}

  \textsc{\normalsize \@date }

  % \textsc{\normalsize \@daffiliation }

  \hrulefill
\end{flushleft}\egroup
}


\begin{document}

% \includepdf{bg_1st_page.pdf}

\AddToShipoutPicture*{\firstpagebackground}

\thispagestyle{empty}

\vspace{400 mm}

\title{$title$}
\author{by $for(author)$$author.name$$sep$, $endfor$}
% \affiliation{by $for(author)$$author.affiliation$$sep$, $endfor$}

\maketitle


%---- TOC begin
\begingroup
\textbf{Table of Content}
\vspace{-10mm}
\let\cleardoublepage\relax
\let\clearpage\relax
\renewcommand\contentsname{}
\tableofcontents
\endgroup
\hrulefill
%---- TOC end

$body$

\end{document}
